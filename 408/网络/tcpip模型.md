





## osi (Open Systems Interconnection) 自下而上
7. application
6. presentation
5. session
4. transport
3. network
2. data link
1. physical
助记用的是please do not throw sausage pizza away

“尽力而为”的传输模型
所有的错误纠正都留给了传输层和应用层来处理

## 一个具体的例子(自上而下)
发送邮件
1. 应用层
首先是outlook邮箱或者gmail邮箱, 无论是app端还是web端, 他都是client
2. 表示层.
编码(将数据从ascii转换为ebcdic, 网络之间需要进行这种转换是因为不同系统可能使用不同的编码标准)
加密(AES, DES, RSA, 保护邮件数据)
压缩(ZIP, RLE减小数据, 以节省带宽, 加快传输)
3. 会话层(session)
这里的连接指的是数据交换的逻辑连接, 而不是特指tcp连接或者物理连接
4. 传输层(transoport层)
这里数据被分割成了TCP段(还有一些其他在这一层用的协议比如说UDP)
为什么要分段呢?
分段意味着将大数据块分为符合下层网络MTU(MTU（最大传输单元）是网络中任何给定链路上能够传输的最大数据包大小)的更小单元，这样做可以减小因单个数据包错误而需要重新传输的数据量
有错误监测和恢复的机制, 错误检测通常通过校验和（checksums）实现, 恢复是通过重传那些检测到错误的数据段实现的，例如TCP通过确认机制和序列号来追踪每个数据段
5. network层
被分配ip地址
路由
一些算法(RIP, OSPF, BGP)根据数据包目的地决定路径
6. 
data link的link指的是各个网络设备之间直接连接
封装成帧(里面包含了控制信息, 比如帧同步, 地址, 错误检测)
数据链路层通过帧中的错误检测码，如循环冗余校验（CRC），来检测错误。当一个帧在物理层传输时，可能因为噪声、信号衰减或其他干扰而导致错误。
果错误是可以预测和模式化的（如单比特错误），某些情况下可以使用纠错码（如汉明码）来恢复原始数据。但在大多数网络设施中，数据链路层更多是通过请求重传来处理检测到的错误，而不是尝试直接纠正它们
(能检测和可能修正物理层产生的错误)
7. 已经是物理层面上的电信号或者光信号了, 发送数据位流0/1


## 数据流(大概看一下就行, 用LLM生成的)
假设我们使用的是一个简单的电子邮件客户端，使用SMTP协议发送邮件，邮件服务器的IP地址为 `192.168.1.2`，我们的电脑有一个局域网IP `192.168.1.100`。

1. **应用层**:
   - 用户在电子邮件客户端中输入"hello"并发送。
   - 应用层将这个消息封装为一个SMTP协议的请求。
   - SMTP协议用于发送邮件，客户端首先必须与邮件服务器建立连接。
   - 客户端向服务器发送SMTP命令，如`HELO`, `MAIL FROM:`, `RCPT TO:`, 和`DATA`。
   - 最后，客户端发送邮件内容，即"hello"。
   - 命令: `HELO client.example.com` （SMTP握手）
   - 命令: `MAIL FROM:<sender@example.com>` （发件人）
   - 命令: `RCPT TO:<recipient@example.net>` （收件人）
   - 命令: `DATA` （邮件正文开始）
   - 数据: `Subject: Test Email\r\n\r\nhello` （邮件主题和内容）
   - 命令: `.` （结束邮件正文）
   - 命令: `QUIT` （结束会话）
2. **表示层**:
   - 可能会对邮件内容进行编码或加密，比如将"hello"转换为一种适合网络传输的格式，可能使用Base64编码或某种加密方法，简单表示为`DES("hello")`。
   - 如果使用了MIME编码，"hello"可能被编码为`Base64`或加密为`DES("hello")`，具体取决于协议和安全要求。
   - 数据可能会经过编码转换（例如ASCII到EBCDIC）。
   - 可能会对数据进行加密，例如使用TLS加密SMTP会话。
3. **会话层**:
   - 建立和邮件服务器的SMTP会话，准备发送邮件。
   - 会话层确保消息能在一个逻辑连接中顺序传输。
   - SMTP对话中，会话层保持并跟踪邮件发送的状态（如已连接、认证、邮件发送中等）。
   - 管理SMTP客户端和服务器之间的对话。
   - 控制SMTP连接、同步和断点重连。
4. **传输层**:
   - 将消息封装到传输协议中，通常是TCP。
   - 为了发送"hello"，我们可能会有一个TCP段，其头部包含源端口号、目标端口号（SMTP端口25）、序列号和确认号等信息。
   - TCP头部加上数据，可能为`TCP(源端口:12345, 目标端口:25, 序列:100, 确认:50, 数据:DES("hello"))`。
   - TCP确保可靠传输。建立连接需要一个三次握手过程：`SYN`、`SYN-ACK`、`ACK`。
   - 在三次握手之后，邮件数据被封装成一个或多个TCP段，发送到目标端口（通常SMTP为25端口）。
   - 为"hello"邮件创建一个TCP段，具体的字段可能如下所示（仅作示例）：
     - 源端口: `12345`
     - 目标端口: `25`
     - 序列号: `100`
     - 确认号: `0`（初始设定）
     - 数据偏移: `5`（没有TCP选项）
     - 控制位: `ACK, PSH`
     - 窗口大小: `8192`
     - 检验和: 计算得出
     - 紧急指针: `0`
     - 选项: `无`
     - 数据: 实际的SMTP数据，包括上述命令和邮件内容
5. **网络层**:
   - 将TCP段封装到IP数据包中，添加源IP和目标IP地址。
   - IP数据包可能为`IP(源:192.168.1.100, 目标:192.168.1.2, 数据:TCP(...))`。
   - IP头包括版本、头长度、服务类型、总长度、标识、标志、片偏移、生存时间（TTL）、协议（TCP为6）、头校验和、源IP和目标IP。
   - 每个TCP段被封装成IP数据包，可能包含`IP(版本:4, 头长:20, 服务类型:0, 总长:40+数据长度, 标识:xxxx, 标志:2, 片偏移:0, TTL:64, 协议:6, 校验和:yyyy, 源IP:192.168.1.100, 目标IP:192.168.1.2)`。
   - 创建一个IP数据包，字段可能包括：
     - 版本: `4`（IPv4）
     - IHL: `5`（没有IP选项）
     - 服务类型: `0`（默认）
     - 总长度: 根据实际长度计算
     - 标识: 分配一个唯一值
     - 标志和片偏移: `0`（不分片）
     - 生存时间: `128`（默认值）
     - 协议: `6`（TCP）
     - 头部校验和: 计算得出
     - 源地址: `192.168.1.100`
     - 目的地址: `192.168.1.2`
6. **数据链路层**:
   - 数据包被进一步封装成一个帧，帧包括物理地址信息（MAC地址）、错误检查和其他必要的控制信息。
   - 帧的示例表示为`帧(源MAC:AA-BB-CC-DD-EE-FF, 目标MAC:11-22-33-44-55-66, 数据:IP(...))`。
   - 在数据链路层，IP数据包被封装成帧，每一帧都包含一个以太网头和尾部，其中包括源MAC地址、目标MAC地址、以太网类型和一个CRC错误检查。
   - 帧示例：`以太网(目标MAC: 11-22-33-44-55-66, 源MAC: AA-BB-CC-DD-EE-FF, 类型: 0x0800, 数据: IP(...), CRC: zzzz)`。
   - 在以太网帧中封装IP数据包，字段包括：
     - 目标MAC地址: `11-22-33-44-55-66`
     - 源MAC地址: `AA-BB-CC-DD-EE-FF`
     - 类型: `0x0800`（表示载荷是IPv4）
     - 数据: IP数据包
     - 帧校验序列: 通过CRC算法计算得出
7. **物理层**:
   - 帧被转换为电信号或光信号，通过物理媒介（如以太网电缆或无线电波）发送。
   - "hello"邮件现在可能是一系列的电脑1和0，如`010100001101001...`，这些信号通过电缆或空气传输给路由器，然后是到ISP，经过互联网，最后到达邮件服务器。
   - 帧在物理层被转换为电信号，透过物理介质发送。
   - 在电缆上，它们可能表示为高低电压的序列，在光纤中则是光脉冲。
   - 将以太网帧编码为电信号，比如使用100BASE-TX标准，在双绞线上使用电压变化来表示比特。

在这个例子中，我们忽略了网络间的路由细节，如ARP查找、路由选择、可能的NAT操作、各种网络设备（如路由器和交换机）的处理等等。此外，每个层可能还有它自己的错误检测和恢复机制，例如在传输层有TCP重传机制，在数据链路层有以太网的碰撞检测和重传机制（如CSMA/CD）。

## ref
https://www.youtube.com/watch?v=kCuyS7ihr_E&list=PLyN7oxIwNU8HIFoj5EggUyJPtGY2WQ1Px&index=16&ab_channel=danscourses