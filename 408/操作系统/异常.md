## 内部异常(内中断)
内部异常指来自cpu内部的产生的中断(指令执行过程中)(电源掉电, 地址非法, 校验错误, 页面失效, 非法指令, 地址越界, 除数为0)
内部异常的检测是cpu自己完成的, 且无法被屏蔽, 一旦出现会立即处理
中断后会转到核心态

### 分类
1. 故障fault
2. 陷阱 trap
3. 终止 abort

### 举例
执行`mov R0, addr`(addr是一个虚拟地址)这样的内存访问指令时，有可能发生缺页异常（page fault）
1. 程序执行`mov R0, addr`指令，试图从内存地址`addr`中读取数据到寄存器`R0`。
2. CPU尝试将虚拟地址`addr`转换为物理地址。
3. 如果`addr`对应的物理内存页不在内存中，那么CPU无法完成地址转换，此时会触发一个缺页异常。
4. 操作系统的缺页异常处理程序会被调用，它将尝试加载缺失的内存页到物理内存中。这可能涉及到从磁盘读取数据，或者在内存中重新分配空间。
5. 一旦缺失的内存页被加载到物理内存中，程序可以重新执行`mov R0, addr`指令，这次地址转换应该能够成功，数据被读取到寄存器`R0`。






## 外部中断(硬件中断)
由外部硬件设备产生(用于通知处理器有外设需要其注意，如键盘输入、鼠标移动、打印机准备好接收数据等)
CPU处理中断的速度非常快，通常在微秒级别（百万分之一秒）。

### 状态保存
1. PC(程序计数器)由中断隐指令(或中断序列, 硬件级别的不需要软件介入)保存到堆栈或专门的寄存器, 为了ISR执行完之后回到中断发生的程序执行点
2. 而寄存器内容由操作系统的中断服务例程负责保存, 进入ISR前操作系统会保存, 之后会恢复继续执行(x86架构的IRET)
至于TLB和Cache是透明于程序执行, 不会保存, 不会影响程序逻辑正确

### 举例
例如，当你按下键盘上的一个键时，键盘控制器会发送一个外部中断信号到处理器，处理器随后中断当前的操作，执行相应的中断服务程序来处理这个键盘输入
处理器的高速运作确保了它能够迅速响应中断，执行中断服务程序（ISR），并在用户察觉之前返回到正常的程序执行流程中。这也是为什么即使在运行复杂计算或大型应用程序的同时，你仍然可以流畅地使用键盘和鼠标的原因。


## 优化
对于非常频繁的中断，系统可能会采用中断合并（coalescing）或其他技术来减少中断处理的开销。